<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Manhwa Reader</title>
    <style>
        body { background-color: #1a1a1a; color: white; text-align: center; font-family: Arial, sans-serif; }
        .reader { max-width: 800px; margin: auto; }
        img { width: 100%; margin-top: 20px; border-radius: 10px; }
        .navigation { margin: 20px 0; }
        button { padding: 10px 20px; font-size: 16px; margin: 5px; cursor: pointer; border: none; border-radius: 5px; background-color: #444; color: white; }
        button:hover { background-color: #666; }
    </style>
</head>
<body>

    <h1 id="manhwa-title"></h1>

    <div class="chapter-selector">
        <label for="chapterSelect">Select Chapter:</label>
        <select id="chapterSelect" onchange="jumpToChapter()"></select>
    </div>

    <div class="reader" id="reader-container"></div>

    <div class="navigation">
        <button onclick="prevChapter()">Previous</button>
        <button onclick="nextChapter()">Next</button>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        let manhwaId = urlParams.get("manhwa");
        let chapterId = urlParams.get("chapter");

        async function fetchChapters() {
            try {
                let response = await fetch(`https://api.mangadex.org/manga/${manhwaId}/aggregate?translatedLanguage[]=en`);
                let data = await response.json();

                let chapterSelect = document.getElementById("chapterSelect");
                chapterSelect.innerHTML = "";

                for (let volume in data.volumes) {
                    for (let ch in data.volumes[volume].chapters) {
                        let chapter = data.volumes[volume].chapters[ch];
                        let option = document.createElement("option");
                        option.value = chapter.id;
                        option.textContent = `Chapter ${chapter.chapter}`;
                        chapterSelect.appendChild(option);
                    }
                }

                chapterSelect.value = chapterId || chapterSelect.options[0]?.value;
                loadChapter(chapterSelect.value);
            } catch (error) {
                console.error("Error fetching chapters:", error);
            }
        }

        async function loadChapter(chapterId) {
            try {
                let response = await fetch(`https://api.mangadex.org/at-home/server/${chapterId}`);
                let data = await response.json();

                let readerContainer = document.getElementById("reader-container");
                readerContainer.innerHTML = "";

                data.chapter.data.forEach(page => {
                    let img = document.createElement("img");
                    img.src = `${data.baseUrl}/data/${data.chapter.hash}/${page}`;
                    readerContainer.appendChild(img);
                });

                document.getElementById("chapterSelect").value = chapterId;
            } catch (error) {
                console.error("Error loading chapter:", error);
            }
        }

        function prevChapter() {
            let chapterSelect = document.getElementById("chapterSelect");
            let prevIndex = chapterSelect.selectedIndex - 1;
            if (prevIndex >= 0) {
                let prevChapterId = chapterSelect.options[prevIndex].value;
                window.location.href = `reader.html?manhwa=${manhwaId}&chapter=${prevChapterId}`;
            }
        }

        function nextChapter() {
            let chapterSelect = document.getElementById("chapterSelect");
            let nextIndex = chapterSelect.selectedIndex + 1;
            if (nextIndex < chapterSelect.options.length) {
                let nextChapterId = chapterSelect.options[nextIndex].value;
                window.location.href = `reader.html?manhwa=${manhwaId}&chapter=${nextChapterId}`;
            }
        }

        function jumpToChapter() {
            let selectedChapter = document.getElementById("chapterSelect").value;
            window.location.href = `reader.html?manhwa=${manhwaId}&chapter=${selectedChapter}`;
        }

        fetchChapters();
    </script>

</body>
</html>
